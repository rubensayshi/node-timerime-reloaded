#!/bin/sh

DIR=`php -r "echo dirname(dirname(realpath('$0')));"`
NODE_MODULES="$DIR/node_modules"

# initialization
if [ "$1" = "--reinstall" -o "$2" = "--reinstall" ]; then
	echo "> reinstall"
    rm -rf $NODE_MODULES
fi

mkdir -p "$NODE_MODULES" && cd "$NODE_MODULES"

##
# @param destination directory (e.g. "doctrine")
# @param URL of the git remote (e.g. http://github.com/doctrine/doctrine2.git)
# @param revision to point the head (e.g. origin/HEAD)
#
install_git()
{
    INSTALL_DIR=$1
    SOURCE_URL=$2
    REV=$3

    echo "> [git] Installing/Updating " $INSTALL_DIR

    if [ -z $REV ]; then
        REV=origin/HEAD
    fi

    if [ ! -d $INSTALL_DIR ]; then
        git clone $CLONE_OPTIONS $SOURCE_URL $INSTALL_DIR
    fi

    cd $INSTALL_DIR
    git fetch origin
    git reset --hard $REV
    cd ..
}

##
# @param name of the npm module (e.g. express)
#
install_npm()
{
    MODULE_NAME=$1

    echo "> [npm] Installing/Updating " $MODULE_NAME

    cd ..
	npm install $MODULE_NAME
    cd "$NODE_MODULES"
}

# DjaNode
install_git djangode git@github.com:rubensayshi/djangode.git

# JS opts
install_git js-opts git://github.com/rubensayshi/js-opts.git

# express
install_npm express

# mongoose
install_npm mongoose

# async
install_npm async